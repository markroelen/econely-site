<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Econely Bestellen</title>
  <style>
    /* (STYLING BLIJFT ONGEWIJZIGD - zie vorige stap) */
    ... (je huidige CSS hier) ...
  </style>
</head>
<body>
  <h1>Stap 1: Stel je bestelling samen</h1>

  <details open>
    <summary>Bakken & Oven</summary>
    <div class="product">
      <label class="switch">
        <input type="checkbox" class="product-checkbox" data-price="3.20" data-name="Bakpapier - 15m - navulling">
        <span class="slider"></span>
      </label>
      <img src="https://cdn.eco-logisch.nl/images/bakpapier_navul.jpg" alt="Bakpapier - 15m - navulling">
      <div>
        <h4>Bakpapier - 15m - navulling</h4>
        <p><strong>€ 3.20</strong></p>
      </div>
    </div>
  </details>

  <div class="totaal">Totale prijs: €<span id="totaalbedrag">0.00</span></div>

  <form id="bestelform">
    <input type="hidden" name="_subject" value="Nieuwe bestelling via Econely">
    <input type="hidden" name="producten" id="productenInput">
    <input type="hidden" name="totaal" id="totaalInput">

    <label>Naam:<br><input type="text" name="naam" id="klantNaam" required></label>
    <label>Emailadres:<br><input type="email" name="email" id="klantEmail" required></label>
    <label>Straat + huisnummer:<br><input type="text" name="adres" required></label>
    <label>Plaats:<br><input type="text" name="plaats" required></label>

    <button type="submit">Verstuur bestelling</button>
  </form>

  <div id="stap2">
    <h2>Stap 2: Betaal je bestelling via Rabobank</h2>
    <p>Na het versturen van het formulier kun je hier betalen. Vul het totaalbedrag handmatig in.</p>
    <a class="button-link" href="https://betaalverzoek.rabobank.nl/betaalverzoek/?id=BJrL5SCVSL-xpRA6BtgHoA" target="_blank">Betaal nu via Rabobank</a>
  </div>

  <script>
    const checkboxes = document.querySelectorAll('.product-checkbox');
    const totaalbedrag = document.getElementById('totaalbedrag');
    const form = document.getElementById('bestelform');
    const productenInput = document.getElementById('productenInput');
    const totaalInput = document.getElementById('totaalInput');

    function getBesteldeProducten() {
      let producten = [];
      checkboxes.forEach(cb => {
        if (cb.checked) {
          producten.push(cb.dataset.name);
        }
      });
      return producten.join(', ');
    }

    function getTotaal() {
      let totaal = 0;
      checkboxes.forEach(cb => {
        if (cb.checked) {
          totaal += parseFloat(cb.dataset.price);
        }
      });
      return totaal.toFixed(2);
    }

    checkboxes.forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        totaalbedrag.textContent = getTotaal();
      });
    });

    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      const producten = getBesteldeProducten();
      const totaal = getTotaal();

      if (!producten || totaal <= 0) {
        alert("Kies minstens één product.");
        return;
      }

      productenInput.value = producten;
      totaalInput.value = totaal;

      const formData = new FormData(form);

      try {
        const response = await fetch("https://formspree.io/f/xnnpdqbq", {
          method: "POST",
          body: formData,
          headers: { 'Accept': 'application/json' }
        });

        if (response.ok) {
          alert("Je bestelling is verzonden. Je kunt nu betalen via stap 2 hieronder.");
          form.reset();
          totaalbedrag.textContent = "0.00";
        } else {
          alert("Er ging iets mis. Probeer het opnieuw.");
        }
      } catch (error) {
        alert("Fout bij verzenden: " + error.message);
      }
    });
  </script>
</body>
</html>
